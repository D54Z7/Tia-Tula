<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Tía Tula - Personajes y Esquema</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@300;400;700&display=swap');

        :root {
            --primary: #5d4037;
            --accent: #8d6e63;
            --bg: #fdfbf7;
            --color-familia: #2e7d32;   /* Verde */
            --color-tension: #fbc02d;  /* Amarillo Huevo */
            --color-pasion: #d32f2f;   /* Rojo */
            --color-espiritual: #9e9e9e; /* Plata */
        }

        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--bg);
            color: #333;
            margin: 0;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        h1, h2, h3 {
            font-family: 'Playfair Display', serif;
        }

        main {
            flex: 1;
        }

        /* Estilos de las tarjetas de personajes */
        .card-expandable {
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #e7e5e4;
            background-color: white;
            position: relative;
            height: fit-content;
        }

        .card-expandable:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .description-content {
            display: grid;
            grid-template-rows: 0fr;
            transition: grid-template-rows 0.4s ease-out, opacity 0.3s ease, margin 0.3s ease;
            opacity: 0;
        }

        .description-content > div {
            overflow: hidden;
        }

        .card-expandable.active {
            border-color: var(--primary);
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            background-color: #fff;
        }

        .card-expandable.active .description-content {
            grid-template-rows: 1fr;
            opacity: 1;
            margin-top: 1rem;
            padding-top: 1rem;
        }

        .chevron-icon {
            transition: transform 0.3s ease;
        }

        .card-expandable.active .chevron-icon {
            transform: rotate(180deg);
        }

        .tab-active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            font-weight: bold;
        }

        /* Estilos de los botones de filtro */
        .filter-btn {
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }
        
        .filter-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Centrado especial para protagonista único */
        .centered-protagonist {
            display: flex;
            justify-content: center;
            width: 100%;
            grid-column: 1 / -1;
        }

        /* Estilos del Mapa */
        .map-container {
            position: relative;
            min-height: 750px;
            background: #fff;
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid #e7e5e4;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.02);
            margin: 20px 0;
        }

        .node {
            position: absolute;
            padding: 1.2rem;
            background: white;
            border: 2px solid #d7ccc8;
            border-radius: 12px;
            z-index: 10;
            text-align: center;
            width: 170px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
        }

        .node.protagonist {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            font-weight: bold;
            width: 190px;
            font-size: 1.1rem;
        }

        .node-subtitle {
            display: block;
            font-size: 0.75rem;
            margin-top: 4px;
            opacity: 0.8;
        }

        svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        /* Estilos del pie de página sutil */
        .footer-sutil {
            padding: 1.5rem 0;
            text-align: center;
            background-color: transparent;
        }

        .autor-text {
            color: #b0a99f; /* Color gris suave más visible que el anterior */
            font-size: 0.75rem; /* Un poco más grande */
            letter-spacing: 0.1em;
            font-weight: 400;
            filter: blur(0.15px); /* Desenfoque muy reducido para mayor claridad */
            user-select: none;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .autor-text:hover {
            opacity: 1;
        }
    </style>
</head>
<body class="p-4 md:p-8 pb-0 md:pb-0">

    <header class="max-w-6xl mx-auto text-center mb-10">
        <h1 class="text-5xl mb-3 text-stone-800 font-bold">La Tía Tula</h1>
        <p class="text-stone-500 italic text-lg">Esquema Narrativo y de Relaciones</p>
    </header>

    <main class="max-w-6xl mx-auto w-full">
        <nav class="flex justify-center mb-8 space-x-6 border-b border-stone-200">
            <button onclick="showSection('personajes')" id="tab-personajes" class="pb-3 px-6 text-stone-400 hover:text-stone-600 transition-all">
                <i class="fas fa-users mr-2"></i>Personajes
            </button>
            <button onclick="showSection('mapa')" id="tab-mapa" class="pb-3 px-6 tab-active transition-all">
                <i class="fas fa-project-diagram mr-2"></i>Mapa de Relaciones
            </button>
        </nav>

        <!-- SECCIÓN PERSONAJES -->
        <section id="sec-personajes" class="hidden">
            <div class="flex justify-center gap-3 mb-8">
                <button onclick="filterCharacters('todos')" id="filter-todos" class="filter-btn active px-4 py-2 rounded-full text-sm font-medium bg-stone-100 text-stone-600 hover:bg-stone-200">
                    Todos
                </button>
                <button onclick="filterCharacters('protagonista')" id="filter-protagonista" class="filter-btn px-4 py-2 rounded-full text-sm font-medium bg-stone-100 text-stone-600 hover:bg-stone-200">
                    Protagonista
                </button>
                <button onclick="filterCharacters('secundario')" id="filter-secundario" class="filter-btn px-4 py-2 rounded-full text-sm font-medium bg-stone-100 text-stone-600 hover:bg-stone-200">
                    Secundarios
                </button>
            </div>

            <div id="character-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 items-start"></div>
        </section>

        <!-- SECCIÓN MAPA -->
        <section id="sec-mapa">
            <div class="text-center mb-6">
                <div class="flex flex-wrap justify-center gap-4 mt-2 text-xs font-bold uppercase tracking-wider">
                    <span style="color: var(--color-familia)"><i class="fas fa-square mr-1"></i> Familia</span>
                    <span style="color: var(--color-tension)"><i class="fas fa-square mr-1"></i> Tensión</span>
                    <span style="color: var(--color-pasion)"><i class="fas fa-square mr-1"></i> Biológico</span>
                    <span style="color: var(--color-espiritual)"><i class="fas fa-square mr-1"></i> Espiritual</span>
                </div>
            </div>
            
            <div class="map-container" id="map-canvas">
                <svg id="svg-connections">
                    <defs id="svg-defs"></defs>
                </svg>

                <div class="node" id="node-don-primitivo" style="top: 12%; left: 50%;">
                    Don Primitivo
                    <span class="node-subtitle">Tío y Origen</span>
                </div>

                <div class="node protagonist" id="node-tula" style="top: 50%; left: 50%;">
                    Gertrudis (Tula)
                    <span class="node-subtitle">Pilar Moral</span>
                </div>
                
                <div class="node" id="node-rosa" style="top: 35%; left: 20%;">
                    Rosa
                    <span class="node-subtitle">Hermana</span>
                </div>

                <div class="node" id="node-ramiro" style="top: 65%; left: 20%;">
                    Ramiro
                    <span class="node-subtitle">Padre Biológico</span>
                </div>

                <div class="node" id="node-ricardo" style="top: 35%; left: 80%;">
                    Ricardo
                    <span class="node-subtitle">Mundo Exterior</span>
                </div>

                <div class="node" id="node-hijos" style="top: 65%; left: 80%;">
                    Los Hijos
                    <span class="node-subtitle">El Destino</span>
                </div>

                <div class="node" id="node-manuela" style="top: 88%; left: 50%;">
                    Manuela
                    <span class="node-subtitle">Criada</span>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer-sutil">
        <p class="autor-text">
            David Contreras Caro
        </p>
    </footer>

    <script>
        const characters = [
            { 
                id: "gertrudis",
                nombre: "Gertrudis (La Tía Tula)", 
                tipo: "protagonista", 
                descripcion: "Eje central de la obra. Encarna una maternidad espiritual que trasciende lo biológico, sacrificando sus deseos por el cuidado de los hijos de otros.", 
                icon: "fa-dove" 
            },
            { 
                id: "rosa",
                nombre: "Rosa", 
                tipo: "secundario", 
                descripcion: "Hermana de Tula y primera esposa de Ramiro. Representa la maternidad biológica frágil.", 
                icon: "fa-leaf" 
            },
            { 
                id: "ramiro",
                nombre: "Ramiro", 
                tipo: "secundario", 
                descripcion: "Esposo de Rosa y luego cuñado de Tula. Simboliza el conflicto entre la carne y el orden moral.", 
                icon: "fa-user-tie" 
            },
            { 
                id: "primitivo",
                nombre: "Don Primitivo", 
                tipo: "secundario", 
                descripcion: "Tío de las hermanas, representa la autoridad tradicional de la familia.", 
                icon: "fa-landmark" 
            },
            { 
                id: "manuela",
                nombre: "Manuela", 
                tipo: "secundario", 
                descripcion: "La criada con la que Ramiro tiene hijos. Su prole también acaba bajo la tutela moral de Gertrudis.", 
                icon: "fa-hand-sparkles" 
            },
            { 
                id: "hijos",
                nombre: "Los Hijos", 
                tipo: "secundario", 
                descripcion: "Tanto los de Rosa como los de Manuela. Son el objeto de la misión vital de Tula.", 
                icon: "fa-children" 
            },
            { 
                id: "ricardo",
                nombre: "Ricardo", 
                tipo: "secundario", 
                descripcion: "Pretendiente de Tula que representa la posibilidad de una vida familiar convencional rechazada.", 
                icon: "fa-times" 
            }
        ];

        let currentFilter = 'todos';

        function toggleCard(id) {
            const targetCard = document.getElementById(`card-${id}`);
            targetCard.classList.toggle('active');
        }

        function filterCharacters(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`filter-${filter}`).classList.add('active');
            renderCharacters();
        }

        function renderCharacters() {
            const grid = document.getElementById('character-grid');
            grid.innerHTML = '';
            const filteredList = currentFilter === 'todos' ? characters : characters.filter(c => c.tipo === currentFilter);
            const isSingleProtagonist = currentFilter === 'protagonista' && filteredList.length === 1;

            filteredList.forEach(char => {
                const wrapper = document.createElement('div');
                if (isSingleProtagonist) wrapper.className = "centered-protagonist";
                const card = document.createElement('div');
                card.id = `card-${char.id}`;
                card.className = `card-expandable p-6 rounded-2xl shadow-sm ${isSingleProtagonist ? 'max-w-md w-full' : ''}`;
                card.onclick = () => toggleCard(char.id);
                card.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-stone-100 rounded-full flex items-center justify-center text-stone-600 mr-4">
                                <i class="fas ${char.icon} text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold">${char.nombre}</h3>
                                <span class="text-xs uppercase tracking-wider text-stone-400 font-bold">${char.tipo}</span>
                            </div>
                        </div>
                        <i class="fas fa-chevron-down text-stone-300 chevron-icon"></i>
                    </div>
                    <div class="description-content">
                        <div class="border-t border-stone-100">
                            <p class="text-stone-600 leading-relaxed text-sm pt-4">${char.descripcion}</p>
                        </div>
                    </div>
                `;
                if (isSingleProtagonist) { wrapper.appendChild(card); grid.appendChild(wrapper); } else { grid.appendChild(card); }
            });
        }

        function showSection(section) {
            document.getElementById('sec-personajes').classList.toggle('hidden', section !== 'personajes');
            document.getElementById('sec-mapa').classList.toggle('hidden', section !== 'mapa');
            document.getElementById('tab-personajes').classList.toggle('tab-active', section === 'personajes');
            document.getElementById('tab-mapa').classList.toggle('tab-active', section === 'mapa');
            if(section === 'mapa') setTimeout(drawConnections, 50);
        }

        function createMarker(id, color) {
            return `<marker id="${id}" markerWidth="10" markerHeight="7" refX="16" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="${color}" /></marker>`;
        }

        function drawConnections() {
            const svg = document.getElementById('svg-connections');
            const defs = document.getElementById('svg-defs');
            const verde = "#2e7d32", amarillo = "#fbc02d", rojo = "#d32f2f", plata = "#9e9e9e";
            defs.innerHTML = createMarker('head-verde', verde) + createMarker('head-amarillo', amarillo) + createMarker('head-rojo', rojo) + createMarker('head-plata', plata);
            svg.innerHTML = ''; svg.appendChild(defs);

            const relations = [
                { from: 'don-primitivo', to: 'tula', color: verde, marker: 'head-verde' },
                { from: 'don-primitivo', to: 'rosa', color: verde, marker: 'head-verde' },
                { from: 'rosa', to: 'tula', color: verde, marker: 'head-verde' },
                { from: 'tula', to: 'ricardo', color: amarillo, marker: 'head-amarillo' },
                { from: 'ramiro', to: 'tula', color: amarillo, marker: 'head-amarillo' },
                { from: 'rosa', to: 'ramiro', color: rojo, marker: 'head-rojo' },
                { from: 'ramiro', to: 'hijos', color: rojo, marker: 'head-rojo' },
                { from: 'ramiro', to: 'manuela', color: rojo, marker: 'head-rojo' },
                { from: 'manuela', to: 'hijos', color: rojo, marker: 'head-rojo' },
                { from: 'tula', to: 'hijos', color: plata, marker: 'head-plata' }
            ];

            const container = document.getElementById('map-canvas').getBoundingClientRect();
            relations.forEach(rel => {
                const startNode = document.getElementById(`node-${rel.from}`);
                const endNode = document.getElementById(`node-${rel.to}`);
                const start = startNode.getBoundingClientRect();
                const end = endNode.getBoundingClientRect();
                const x1 = (start.left + start.width / 2) - container.left;
                const y1 = (start.top + start.height / 2) - container.top;
                const x2 = (end.left + end.width / 2) - container.left;
                const y2 = (end.top + end.height / 2) - container.top;
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", x1); line.setAttribute("y1", y1); line.setAttribute("x2", x2); line.setAttribute("y2", y2);
                line.setAttribute("stroke", rel.color); line.setAttribute("stroke-width", "3");
                line.setAttribute("marker-end", `url(#${rel.marker})`);
                svg.appendChild(line);
            });
        }

        window.onload = () => { renderCharacters(); showSection('mapa'); };
        window.onresize = () => { if(!document.getElementById('sec-mapa').classList.contains('hidden')) drawConnections(); };
    </script>
</body>
</html>